<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Filter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .btn-group {
            margin-bottom: 20px;
        }
        .results-container {
            margin-top: 20px;
        }
        .combination {
            background-color: #f8f9fa;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .stats {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .pagination {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Lottery Filter</h1>
        
        <div class="row mb-4">
            <div class="col-md-4">
                <label for="totalNumbers" class="form-label">Total Numbers:</label>
                <input type="number" class="form-control" id="totalNumbers" value="37" min="1">
            </div>
            <div class="col-md-4">
                <label for="numbersToPick" class="form-label">Numbers to Pick:</label>
                <input type="number" class="form-control" id="numbersToPick" value="6" min="1">
            </div>
            <div class="col-md-4">
                <label for="numSets" class="form-label">Number of Random Sets:</label>
                <input type="number" class="form-control" id="numSets" value="5" min="1" max="1000">
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="filterThreeEven">
                    <label class="form-check-label" for="filterThreeEven">
                        Filter for exactly 3 even numbers
                    </label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="filterThreeConsecutive">
                    <label class="form-check-label" for="filterThreeConsecutive">
                        Filter out sets with 3+ consecutive numbers
                    </label>
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="generateCombinations()">Generate Combinations</button>
            <button class="btn btn-success ms-2" onclick="generateRandomSets()">Generate Random Sets</button>
        </div>

        <div id="stats" class="stats d-none"></div>
        <div id="results" class="results-container"></div>
        <div id="pagination" class="d-flex justify-content-center"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPage = 1;
        
        function displayStats(stats) {
            const statsDiv = document.getElementById('stats');
            statsDiv.classList.remove('d-none');
            
            statsDiv.innerHTML = `
                <h4>Statistics:</h4>
                <p>Total Sets: ${stats.total_sets}</p>
                <p>Average Sum: ${stats.avg_sum.toFixed(2)}</p>
                <p>Min Sum: ${stats.min_sum}</p>
                <p>Max Sum: ${stats.max_sum}</p>
                <p>Average Even Numbers: ${stats.avg_even_count.toFixed(2)}</p>
                <p>Sets with Consecutive Numbers: ${stats.consecutive_count}</p>
                <p>Sets with 3+ Consecutive Numbers: ${stats.three_consecutive_count}</p>
            `;
        }

        function displayCombinations(data) {
            const resultsDiv = document.getElementById('results');
            const paginationDiv = document.getElementById('pagination');
            
            resultsDiv.innerHTML = '';
            data.combinations.forEach(combo => {
                const div = document.createElement('div');
                div.className = 'combination';
                div.innerHTML = `
                    <strong>Numbers:</strong> ${combo.numbers.join(', ')}
                    <br>
                    <strong>Sum:</strong> ${combo.sum}
                `;
                resultsDiv.appendChild(div);
            });

            // Create pagination
            const totalPages = data.total_pages;
            let paginationHTML = `
                <nav>
                    <ul class="pagination">
                        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>
                        </li>
            `;

            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                paginationHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
            }

            paginationHTML += `
                        <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>
                        </li>
                    </ul>
                </nav>
            `;
            paginationDiv.innerHTML = paginationHTML;
        }

        function displayRandomSets(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            displayStats(data.stats);
            
            data.random_sets.forEach(set => {
                const div = document.createElement('div');
                div.className = 'combination';
                div.innerHTML = `
                    <strong>Numbers:</strong> ${set.numbers.join(', ')}
                    <br>
                    <strong>Sum:</strong> ${set.sum}
                    <br>
                    <strong>Even Numbers:</strong> ${set.even_count}
                    <br>
                    <strong>Has Consecutive Numbers:</strong> ${set.has_consecutive ? 'Yes' : 'No'}
                    <br>
                    <strong>Has 3+ Consecutive Numbers:</strong> ${set.has_three_consecutive ? 'Yes' : 'No'}
                `;
                resultsDiv.appendChild(div);
            });
        }

        function changePage(page) {
            currentPage = page;
            generateCombinations();
        }

        async function generateCombinations() {
            const totalNumbers = parseInt(document.getElementById('totalNumbers').value);
            const numbersToPick = parseInt(document.getElementById('numbersToPick').value);
            
            try {
                const response = await fetch('/combinations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        totalNumbers,
                        numbersToPick,
                        page: currentPage
                    }),
                });
                
                const data = await response.json();
                if (data.error) {
                    alert(data.error);
                    return;
                }
                
                displayCombinations(data);
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while generating combinations');
            }
        }

        async function generateRandomSets() {
            const totalNumbers = parseInt(document.getElementById('totalNumbers').value);
            const numbersToPick = parseInt(document.getElementById('numbersToPick').value);
            const numSets = parseInt(document.getElementById('numSets').value);
            const filterThreeEven = document.getElementById('filterThreeEven').checked;
            const filterThreeConsecutive = document.getElementById('filterThreeConsecutive').checked;
            
            try {
                const response = await fetch('/random-sets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        totalNumbers,
                        numbersToPick,
                        numSets,
                        filterThreeEven,
                        filterThreeConsecutive
                    }),
                });
                
                const data = await response.json();
                if (data.error) {
                    alert(data.error);
                    return;
                }
                
                displayRandomSets(data);
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while generating random sets');
            }
        }
    </script>
</body>
</html>
